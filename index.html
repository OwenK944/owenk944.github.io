<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Owen Klea — LUMEN-GLASS // SINGULARITY</title>
<meta name="description" content="Single-file cinematic portfolio: liquid glass, displacement text, parallax nebula, magnetic cursor, ripple clicks, particle trail, buttery tilt.">
<meta name="color-scheme" content="dark light"/>

<style>
/* ============== TOKENS ============== */
:root{
  --bg:#070a10; --bg2:#0b0f19;
  --ink:#eaf1ff; --muted:#9fb0c7; --line:rgba(255,255,255,.16);
  --glass:rgba(255,255,255,.08);
  --accent:#66e0ff; --accent2:#b07aff; --accent3:#ffb84d;
  --r:18px; --r-lg:24px; --shadow:0 22px 70px rgba(0,0,0,.5);
  --fs0:clamp(.96rem,.92rem + .2vw,1.06rem);
  --fs1:clamp(1.18rem,1rem + .9vw,1.42rem);
  --fs2:clamp(1.9rem,1.2rem + 2.2vw,2.8rem);
  --fs3:clamp(3rem,1.6rem + 4.4vw,4.8rem);
}
@media (prefers-color-scheme:light){
  :root{
    --bg:#f6f9ff; --bg2:#eef3fb; --ink:#0e1522; --muted:#51607c; --line:rgba(10,20,35,.18);
    --glass:rgba(255,255,255,.66); --shadow:0 22px 60px rgba(12,16,24,.14)
  }
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink); font:400 var(--fs0)/1.6 ui-sans-serif,system-ui,Inter,Segoe UI,Roboto,Arial;
  background:var(--bg); overflow-x:hidden;
}
a{color:var(--accent); text-decoration:none}
a:hover{text-decoration:underline; text-underline-offset:3px}
small,.muted{color:var(--muted)}
kbd{font:600 .9rem/1 ui-monospace,Menlo,Consolas,monospace; background:var(--glass); border:1px solid var(--line); padding:2px 6px; border-radius:6px}

/* ============== PROGRESS & HUE LINK ============== */
.progress{position:fixed; top:0; left:0; height:4px; width:100vw; z-index:40;
  background:linear-gradient(90deg, var(--accent) var(--pct,0%), transparent 0)}
:root{ --hue: 0deg }
.huelink{ filter: hue-rotate(var(--hue)); transition:filter .4s ease }

/* ============== BACKGROUND ============== */
.layer{position:fixed; inset:0; pointer-events:none; z-index:-3}
#bg0,#bg1{width:100%; height:100%}
#bg1{opacity:.18; mix-blend-mode:screen}
.noise{position:fixed; inset:-20%; z-index:-2; opacity:.1; mix-blend-mode:overlay;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="120" height="120" filter="url(%23n)" opacity="0.6"/></svg>');
  background-size:220px 220px; animation:noise 8s linear infinite
}
@keyframes noise{from{transform:translate3d(0,0,0)} to{transform:translate3d(-2%,1%,0)}}

/* ============== NAV ============== */
.nav{
  position:sticky; top:12px; z-index:30; margin:14px auto 0; max-width:1200px;
  display:flex; gap:10px; align-items:center; padding:10px 12px; border-radius:999px;
  border:1px solid var(--line); background:linear-gradient(180deg, var(--glass), transparent);
  backdrop-filter: blur(18px) saturate(170%); -webkit-backdrop-filter: blur(18px) saturate(170%);
  box-shadow:var(--shadow)
}
.logo{width:30px;height:30px;border-radius:50%; background:conic-gradient(from 0deg, var(--accent), var(--accent2), var(--accent)); box-shadow:0 0 18px color-mix(in srgb, var(--accent) 50%, transparent)}
.nav .sp{margin-left:auto; display:flex; gap:8px; align-items:center}
.btn{
  padding:10px 14px; border-radius:999px; border:1px solid var(--line);
  background:linear-gradient(180deg, var(--glass), transparent); color:inherit; cursor:pointer; position:relative; overflow:hidden
}
.btn:active{transform:translateY(1px)}
.btn .ripple{position:absolute; border-radius:50%; transform:translate(-50%,-50%); pointer-events:none; background:color-mix(in srgb, var(--accent) 30%, #fff); opacity:.35}

/* ============== LAYOUT ============== */
.wrap{max-width:1200px; margin:0 auto; padding:12px}
.section{position:relative; margin:18px 0; border:1px solid var(--line); border-radius:var(--r-lg);
  background:linear-gradient(180deg, var(--glass), transparent); box-shadow:var(--shadow);
  overflow:hidden; transform:translateY(12px); opacity:0; transition:transform .7s cubic-bezier(.2,.7,.2,1), opacity .6s ease}
.section.show{transform:translateY(0); opacity:1}
.head{display:flex; gap:10px; align-items:end; padding:18px 18px 6px}
.head h2{font:900 var(--fs2)/1.02 ui-sans-serif,system-ui; margin:0}
.rule{height:1px; background:var(--line); margin:8px 0}
.content{padding:10px 18px 18px}

/* ============== HERO with LIQUID TEXT ============== */
.hero{display:grid; grid-template-columns: 1.15fr .85fr; gap:16px; align-items:stretch}
.glass{
  border:1px solid var(--line); border-radius:var(--r); padding:18px; position:relative; overflow:hidden;
  background:linear-gradient(180deg, color-mix(in srgb, var(--glass) 80%, transparent), transparent);
  backdrop-filter: blur(22px) saturate(165%); -webkit-backdrop-filter: blur(22px) saturate(165%);
}
h1.liquid{
  font:900 var(--fs3)/.98 ui-sans-serif,system-ui; margin:0 0 10px; letter-spacing:.02em;
  filter:url(#liquid);
}
.hero p{font-size:var(--fs1); color:var(--muted); margin:0}

/* tilt + shine (springier) */
.tilt{
  transform-style:preserve-3d; transform: perspective(900px) rotateX(var(--rx,0)) rotateY(var(--ry,0));
  transition:transform .06s linear;
}
.tilt .shine{
  position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
  background: radial-gradient(800px 500px at var(--mx,50%) var(--my,50%), color-mix(in srgb, var(--accent) 25%, transparent), transparent 42%);
  opacity:.45; mix-blend-mode:screen;
}

/* magnetic hover for tiles/buttons */
.magnetic{transition: transform .12s ease}

/* ============== PROJECTS ============== */
.grid{display:grid; gap:12px; grid-template-columns:repeat(12,minmax(0,1fr))}
.card{
  grid-column:span 4; position:relative; border:1px solid var(--line); border-radius:16px; padding:12px; overflow:hidden;
  background:linear-gradient(180deg, var(--glass), transparent); backdrop-filter: blur(14px) saturate(160%); -webkit-backdrop-filter: blur(14px) saturate(160%);
  transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease;
}
.card:hover{ transform:translateY(-2px); box-shadow:var(--shadow); border-color: color-mix(in srgb, var(--accent) 50%, var(--line))}
.thumb{
  height:140px; border:1px solid var(--line); border-radius:12px; margin-bottom:8px;
  background:
    radial-gradient(320px 180px at 20% 20%, color-mix(in srgb, var(--accent) 30%, transparent), transparent 60%),
    radial-gradient(320px 180px at 80% 80%, color-mix(in srgb, var(--accent2) 26%, transparent), transparent 60%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.08) 0 1px, transparent 1px 2px);
}
.tags{display:flex; gap:6px; flex-wrap:wrap}
.tag{font-size:.82rem; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:linear-gradient(180deg, var(--glass), transparent)}
dialog{ width:min(900px,92vw); border:none; border-radius:22px; overflow:hidden; border:1px solid var(--line);
  background:linear-gradient(180deg, var(--glass), transparent); color:var(--ink); box-shadow:var(--shadow); backdrop-filter: blur(22px) saturate(160%) }
dialog::backdrop{ background:rgba(0,0,0,.45); backdrop-filter: blur(2px) }
.sheet-head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line)}
.sheet-body{padding:16px}
.close{all:unset; padding:6px 10px; border-radius:10px; border:1px solid var(--line); cursor:pointer}

/* reel strip */
.strip{overflow:auto hidden; padding:12px}
.track{display:flex; gap:12px; width:max-content; animation:mar 24s linear infinite}
.track:hover{animation-play-state:paused}
.tile{min-width:320px; border:1px solid var(--line); border-radius:14px; padding:10px; background:linear-gradient(180deg, var(--glass), transparent)}
.tile .wide{height:120px; border:1px solid var(--line); border-radius:10px; margin-bottom:8px; background:
  conic-gradient(from 0deg at 70% 30%, rgba(255,255,255,.1), transparent 30%, rgba(255,255,255,.1)),
  radial-gradient(320px 180px at 15% 25%, color-mix(in srgb, var(--accent) 28%, transparent), transparent 60%);}
@keyframes mar{from{transform:translateX(0)} to{transform:translateX(-50%)}}

/* CONTACT */
.input{width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--line); background:linear-gradient(180deg, var(--bg2), var(--bg)); color:inherit}
textarea.input{min-height:120px; resize:vertical}

/* RESPONSIVE */
@media (max-width:1080px){ .card{grid-column:span 6} .hero{grid-template-columns:1fr} }
@media (max-width:720px){ .card{grid-column:span 12} }

/* PRINT */
@media print{
  .nav,.strip,.noise,.layer,.progress{display:none!important}
  .section{box-shadow:none; border:1px solid #999}
  a{color:#000}
}

/* Reduced motion */
@media (prefers-reduced-motion:reduce){
  *{animation-duration:.001s !important; transition:none !important}
  .track{animation:none}
}
.sr{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
<div class="progress"></div>

<!-- dynamic background -->
<canvas id="bg0" class="layer"></canvas>
<canvas id="bg1" class="layer huelink"></canvas>
<div class="noise"></div>

<!-- NAV -->
<div class="nav huelink magnetic" data-mag>
  <div class="logo" aria-hidden="true"></div>
  <b>Owen Klea</b><span class="muted">&nbsp;· Filmmaker • Game Dev • Creative Tech</span>
  <div class="sp">
    <span class="muted">Keys: <kbd>1–5</kbd> jump • <kbd>[</kbd>/<kbd>]</kbd> palette • <kbd>P</kbd> print</span>
    <button class="btn" id="pal">🎨 Palette</button>
    <button class="btn" id="theme">🌗 Theme</button>
    <button class="btn" id="print">⤓ PDF</button>
  </div>
</div>

<!-- CONTENT -->
<main class="wrap">
  <!-- HERO -->
  <section id="home" class="section">
    <div class="head"><h2 class="huelink">Craft that glows, systems that hold.</h2></div>
    <div class="content hero">
      <div class="glass tilt magnetic" data-tilt data-mag>
        <h1 class="liquid">LUMEN-GLASS</h1>
        <p>Liquid glass UI, kinetic nebula, magnetic hover, click ripples, 3D tilt with spring, and a particle trail — all in a single HTML file, zero dependencies.</p>
        <div class="rule"></div>
        <div class="tags" style="filter:url(#goo)">
          <span class="tag">Cinematography</span><span class="tag">UE5 Systems</span><span class="tag">3D Printing</span><span class="tag">Web/Design</span><span class="tag">Content Ops</span>
        </div>
        <div class="shine"></div>
      </div>
      <div class="glass tilt magnetic" data-tilt data-mag>
        <b>Capabilities</b>
        <div class="rule"></div>
        <ul style="margin:0 0 8px 18px">
          <li>Shot → grade pipelines with on-set LUT</li>
          <li>UE5: spline trails, collectibles, persistence</li>
          <li>3D print ops: design → finish → ship</li>
          <li>Content systems: YT/podcast kits</li>
        </ul>
        <small class="muted">All motion respects reduced-motion. Print stays clean.</small>
        <div class="shine"></div>
      </div>
    </div>
  </section>

  <!-- PROJECTS -->
  <section id="work" class="section">
    <div class="head"><h2 class="huelink">Selected Work</h2></div>
    <div class="content">
      <div class="grid" id="grid">
        <!-- 1 -->
        <article class="card tilt magnetic" data-tilt data-mag>
          <div class="thumb huelink"></div>
          <h3>Grid Runner — UE5.4</h3>
          <p class="muted">Open-world synthwave driving; spline trails leave story fragments and persist via save/load.</p>
          <div class="tags"><span class="tag">Game</span><span class="tag">UE5</span><span class="tag">Design</span></div>
          <div class="rule"></div>
          <button class="btn" data-open="#d1">Quick View</button>
          <template id="d1">
            <h3>Grid Runner — UE5.4</h3>
            <ul>
              <li>Spline trail with brightness states; permanent visibility</li>
              <li>Fragment triggers + persistence (save/load)</li>
              <li>Biomes: Miami sunset, neon desert, vaporwave sands</li>
            </ul>
            <p><b>Pillars:</b> traversal loop • diegetic UI • perf budgets</p>
          </template>
          <div class="shine"></div>
        </article>

        <!-- 2 -->
        <article class="card tilt magnetic" data-tilt data-mag>
          <div class="thumb huelink"></div>
          <h3>“GreyOS” — Cyberpunk Short</h3>
          <p class="muted">Dialogue tension with in-camera HUD overlays and stylized grade; LUT decisions on set.</p>
          <div class="tags"><span class="tag">Film</span><span class="tag">VFX</span></div>
          <div class="rule"></div>
          <button class="btn" data-open="#d2">Quick View</button>
          <template id="d2">
            <h3>“GreyOS” — Cyberpunk Short</h3>
            <ul>
              <li>ProRes pipeline; on-set LUT</li>
              <li>Xenyx X1204USB capture + foley pass</li>
              <li>Teal/magenta rolloff; restrained halation</li>
            </ul>
          </template>
          <div class="shine"></div>
        </article>

        <!-- 3 -->
        <article class="card tilt magnetic" data-tilt data-mag>
          <div class="thumb huelink"></div>
          <h3>GitHub Portfolio — Editor UI</h3>
          <p class="muted">Portfolio that feels like an NLE timeline: panels, scopes, keyboard nav. Vanilla CSS/JS.</p>
          <div class="tags"><span class="tag">Web</span><span class="tag">Design</span><span class="tag">Code</span></div>
          <div class="rule"></div>
          <button class="btn" data-open="#d3">Quick View</button>
          <template id="d3">
            <h3>Editor-Style Portfolio</h3>
            <p>Custom CSS grid panels with keyboard nav and responsive timeline motif. No libraries.</p>
          </template>
          <div class="shine"></div>
        </article>

        <!-- 4 -->
        <article class="card tilt magnetic" data-tilt data-mag>
          <div class="thumb huelink"></div>
          <h3>POG Deck — Synthwave Cards</h3>
          <p class="muted">Back design, tuck box, booklet, subtle multi-game markings.</p>
          <div class="tags"><span class="tag">Design</span><span class="tag">Print</span></div>
          <div class="rule"></div>
          <button class="btn" data-open="#d4">Quick View</button>
          <template id="d4">
            <h3>POG Deck — Synthwave Cards</h3>
            <p>Gradient sun + grid motif; finish tests; marked fronts compatible with Coup/Munchkin variants.</p>
          </template>
          <div class="shine"></div>
        </article>

        <!-- 5 -->
        <article class="card tilt magnetic" data-tilt data-mag>
          <div class="thumb huelink"></div>
          <h3>Null Point — 3D Printed Mods</h3>
          <p class="muted">Charms, stands, coasters; Fusion → print → ship pipelines, press-fit tolerances dialed.</p>
          <div class="tags"><span class="tag">3D Print</span><span class="tag">Product</span></div>
          <div class="rule"></div>
          <button class="btn" data-open="#d5">Quick View</button>
          <template id="d5">
            <h3>Null Point — 3D Printed Mods</h3>
            <ul>
              <li>Press-fit iteration; TPU flex parts</li>
              <li>Packaging + Etsy ops (U.S. & international)</li>
            </ul>
          </template>
          <div class="shine"></div>
        </article>

        <!-- 6 -->
        <article class="card tilt magnetic" data-tilt data-mag>
          <div class="thumb huelink"></div>
          <h3>404: Topic Not Found — Podcast</h3>
          <p class="muted">Chaos mechanic + audio puzzles; weekly asset kit and colorways.</p>
          <div class="tags"><span class="tag">Podcast</span><span class="tag">Design</span></div>
          <div class="rule"></div>
          <button class="btn" data-open="#d6">Quick View</button>
          <template id="d6">
            <h3>404: Topic Not Found — Podcast</h3>
            <p>Template system for episode drops, polls with consequences, and hidden audio puzzles.</p>
          </template>
          <div class="shine"></div>
        </article>
      </div>
    </div>
  </section>

  <!-- REEL STRIP -->
  <section id="reels" class="section">
    <div class="head"><h2 class="huelink">Reel Strips</h2></div>
    <div class="content strip">
      <div class="track">
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>Grid Runner — Trails</b><div class="muted">Spline brightness demo.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>GreyOS — Grade</b><div class="muted">LUT + restrained halation.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>Null Point — TPU</b><div class="muted">Press-fit prototype set.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>404 Podcast</b><div class="muted">Drop kit + puzzle cue.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>Editor UI</b><div class="muted">NLE-style layout.</div></div>
        <!-- loop for seamless marquee -->
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>Grid Runner — Trails</b><div class="muted">Spline brightness demo.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>GreyOS — Grade</b><div class="muted">LUT + restrained halation.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>Null Point — TPU</b><div class="muted">Press-fit prototype set.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>404 Podcast</b><div class="muted">Drop kit + puzzle cue.</div></div>
        <div class="tile magnetic" data-mag><div class="wide huelink"></div><b>Editor UI</b><div class="muted">NLE-style layout.</div></div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="section">
    <div class="head"><h2 class="huelink">About</h2></div>
    <div class="content">
      <p>Creator from Ohio shipping films, UE5 mechanics, and physical goods. I like clean pipelines, readable code, and visuals that slap.</p>
      <ul>
        <li>Blackmagic Pocket 6K owner • scopes + sound hygiene</li>
        <li>UE5 systems: spline trails, collectibles, save/load</li>
        <li>Etsy & Fiverr ops; repeatable content pipelines</li>
      </ul>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="section">
    <div class="head"><h2 class="huelink">Contact</h2></div>
    <div class="content">
      <form onsubmit="sendMail(event)">
        <label class="sr" for="name">Name</label>
        <input id="name" class="input" placeholder="Your name" required style="margin-bottom:8px">
        <label class="sr" for="email">Email</label>
        <input id="email" type="email" class="input" placeholder="you@example.com" required style="margin-bottom:8px">
        <label class="sr" for="msg">Message</label>
        <textarea id="msg" class="input" placeholder="Project details & timeline" required></textarea>
        <div style="display:flex; gap:10px; margin-top:10px">
          <button class="btn" type="submit">✉️ Send</button>
          <button class="btn" type="button" id="copyEmail">Copy Email</button>
        </div>
      </form>
      <p class="muted" style="margin-top:10px">Elsewhere:
        <a href="#" onclick="alert('Link your GitHub');return false;">GitHub</a> ·
        <a href="#" onclick="alert('Link your YouTube');return false;">YouTube</a> ·
        <a href="#" onclick="alert('Link your Etsy');return false;">Etsy</a> ·
        <a href="#" onclick="alert('Link your Fiverr');return false;">Fiverr</a>
      </p>
    </div>
  </section>

  <footer>© <span id="year"></span> Owen Klea — single-file HTML/CSS/JS.</footer>
</main>

<!-- MODAL -->
<dialog id="sheet">
  <div class="sheet-head"><b id="sTitle">Title</b><button class="close" id="sClose">Close</button></div>
  <div class="sheet-body" id="sBody">…</div>
</dialog>

<!-- SVG FILTERS (LIQUID + GOO) -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <filter id="liquid">
      <feTurbulence type="fractalNoise" baseFrequency="0.006" numOctaves="3" seed="7" result="turb"/>
      <feDisplacementMap in="SourceGraphic" in2="turb" scale="18" xChannelSelector="R" yChannelSelector="G"/>
      <animate xlink:href="#liquid feTurbulence" attributeName="baseFrequency" dur="10s" values="0.006;0.009;0.006" repeatCount="indefinite"/>
    </filter>
    <filter id="goo">
      <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="b"/>
      <feColorMatrix in="b" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 22 -12" result="goo"/>
      <feBlend in="SourceGraphic" in2="goo"/>
    </filter>
  </defs>
</svg>

<script>
/* ===== helpers ===== */
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));

/* ===== state ===== */
const EMAIL='hello@example.com';
const palettes=[
  ['#66e0ff','#b07aff','#ffb84d'], // default
  ['#ff8a00','#00b7ff','#ffd34e'], // miami
  ['#7ae582','#4cc9f0','#e7ff8a'], // steel
  ['#ff5cc0','#6cf2ff','#fff16c'], // neon candy
  ['#b6ffea','#9fa8ff','#ff8df7']  // iceberry
];
let palIdx=0;

/* ===== progress + hue link ===== */
const progress=$('.progress');
function setProgress(){
  const sc=scrollY, total=document.documentElement.scrollHeight - innerHeight;
  const pct = total>0 ? (sc/total) : 0;
  progress.style.setProperty('--pct', (pct*100).toFixed(1)+'%');
  // hue travels 0 -> 90deg
  document.documentElement.style.setProperty('--hue', (pct*90).toFixed(1)+'deg');
}
addEventListener('scroll', setProgress); addEventListener('resize', setProgress); setProgress();

/* ===== section reveal ===== */
const io=new IntersectionObserver((ents)=>ents.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); } }), {threshold:.12});
$$('.section').forEach(s=>io.observe(s));

/* ===== printable actions ===== */
$('#year').textContent=new Date().getFullYear();
$('#print').onclick=()=>window.print();

/* ===== palette + theme ===== */
function applyPalette(i){
  palIdx=((i%palettes.length)+palettes.length)%palettes.length;
  const [a,b,c]=palettes[palIdx];
  document.documentElement.style.setProperty('--accent',a);
  document.documentElement.style.setProperty('--accent2',b);
  document.documentElement.style.setProperty('--accent3',c);
  localStorage.setItem('palIdx',palIdx);
}
function cyclePalette(dir){ applyPalette(palIdx+dir); }
$('#pal').onclick=()=>cyclePalette(1);
applyPalette(+localStorage.getItem('palIdx')||0);

function setTheme(mode){ document.documentElement.dataset.theme=mode; document.documentElement.style.colorScheme=mode; localStorage.setItem('theme',mode); }
$('#theme').onclick=()=>setTheme(document.documentElement.dataset.theme==='light'?'dark':'light');
(function(){ const t=localStorage.getItem('theme'); if(t) setTheme(t); })();

/* ===== modal ===== */
const sheet=$('#sheet'), sTitle=$('#sTitle'), sBody=$('#sBody');
$$('[data-open]').forEach(b=>b.addEventListener('click',(e)=>{
  ripple(e); const tpl=$(b.dataset.open, b.closest('.card'));
  sTitle.textContent=tpl.content.querySelector('h3')?.textContent || 'Details';
  sBody.innerHTML=''; sBody.appendChild(tpl.content.cloneNode(true));
  sheet.showModal();
}));
$('#sClose').onclick=()=>sheet.close();
sheet.addEventListener('click',e=>{ if(!e.target.closest('.sheet-body,.sheet-head')) sheet.close(); });

/* ===== magnetic cursor ===== */
let mx=innerWidth/2, my=innerHeight/2;
addEventListener('pointermove', e=>{ mx=e.clientX; my=e.clientY; });
const magnets=$$('[data-mag]');
function chase(){
  for(const el of magnets){
    const r=el.getBoundingClientRect(), cx=r.left+r.width/2, cy=r.top+r.height/2;
    const dx=(mx-cx)/r.width, dy=(my-cy)/r.height;
    const force = Math.max(Math.abs(dx),Math.abs(dy));
    const mag = Math.min(10, 14*force);
    el.style.transform = `translate(${dx*mag}px, ${dy*mag}px)`;
  }
  requestAnimationFrame(chase);
}
chase();

/* ===== click ripple ===== */
function ripple(e){
  const t = e.currentTarget;
  const rect=t.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;
  const r=document.createElement('span'); r.className='ripple'; r.style.left=x+'px'; r.style.top=y+'px';
  const max=Math.max(rect.width,rect.height);
  r.style.width=r.style.height=max*1.6+'px';
  t.appendChild(r);
  r.animate([{opacity:.35, transform:'translate(-50%,-50%) scale(.2)'},{opacity:0, transform:'translate(-50%,-50%) scale(1)'}],{duration:560,easing:'cubic-bezier(.2,.7,.2,1)'})
    .onfinish=()=>r.remove();
}
$$('.btn').forEach(b=>b.addEventListener('click',ripple));

/* ===== buttery 3D tilt (with spring settle) ===== */
$$('[data-tilt]').forEach(card=>{
  let vx=0, vy=0, rx=0, ry=0; // velocities for spring
  const damp=.85, stiff=.12;
  function frame(){
    vx += (parseFloat(card.style.getPropertyValue('--rx'))||0) - rx;
    vy += (parseFloat(card.style.getPropertyValue('--ry'))||0) - ry;
    rx += vx*stiff; ry += vy*stiff; vx*=damp; vy*=damp;
    card.style.transform = `perspective(900px) rotateX(${rx}) rotateY(${ry})`;
    requestAnimationFrame(frame);
  }
  frame();
  card.addEventListener('pointermove', e=>{
    const r=card.getBoundingClientRect(), x=(e.clientX-r.left)/r.width, y=(e.clientY-r.top)/r.height;
    card.style.setProperty('--rx', ((.5-y)*10).toFixed(2)+'deg');
    card.style.setProperty('--ry', ((x-.5)*14).toFixed(2)+'deg');
    card.style.setProperty('--mx', (x*100)+'%'); card.style.setProperty('--my', (y*100)+'%');
  });
  card.addEventListener('pointerleave', ()=>{
    card.style.setProperty('--rx','0'); card.style.setProperty('--ry','0');
  });
});

/* ===== canvas backgrounds (parallax + particles) ===== */
const c0=$('#bg0'), g0=c0.getContext('2d');
const c1=$('#bg1'), g1=c1.getContext('2d');
function resize(){ c0.width=c1.width=innerWidth; c0.height=c1.height=innerHeight; }
resize(); addEventListener('resize',resize);
const nebula=[...Array(7)].map(()=>({
  x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:120+Math.random()*220,
  vx:(Math.random()-.5)*0.18, vy:(Math.random()-.5)*0.18
}));
const stars=[...Array(120)].map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight, s:Math.random()*1.3+0.2, a:Math.random()*1}));

let px=innerWidth/2, py=innerHeight/2; // parallax cursor
addEventListener('pointermove', e=>{ px=e.clientX; py=e.clientY; });

function loop(){
  // layer 0 — broad color blobs
  g0.clearRect(0,0,c0.width,c0.height);
  g0.globalCompositeOperation='screen';
  for(let i=0;i<nebula.length;i++){
    const n=nebula[i];
    const grad=g0.createRadialGradient(n.x,n.y,0,n.x,n.y,n.r);
    const a=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
    const b=getComputedStyle(document.documentElement).getPropertyValue('--accent2').trim();
    grad.addColorStop(0, (i%2?b:a)+'cc');
    grad.addColorStop(1, '#0000');
    g0.fillStyle=grad; g0.beginPath(); g0.arc(n.x,n.y,n.r,0,Math.PI*2); g0.fill();
    n.x+=n.vx; n.y+=n.vy;
    if(n.x<-300) n.x=c0.width+300; if(n.x>c0.width+300) n.x=-300;
    if(n.y<-300) n.y=c0.height+300; if(n.y>c0.height+300) n.y=-300;
  }
  g0.globalCompositeOperation='source-over';

  // layer 1 — parallax stars + particle trail
  g1.clearRect(0,0,c1.width,c1.height);
  const cx=c1.width/2, cy=c1.height/2, dx=(px-cx)/cx, dy=(py-cy)/cy;
  for(const s of stars){
    const pxs = s.x + dx*18*s.s;
    const pys = s.y + dy*18*s.s;
    g1.globalAlpha = 0.6*s.a;
    g1.fillStyle='#ffffff';
    g1.fillRect(pxs, pys, s.s, s.s);
    s.a += (Math.random()-.5)*0.02; if(s.a<0) s.a=0; if(s.a>1) s.a=1;
  }
  requestAnimationFrame(loop);
}
loop();

/* ===== keyboard nav ===== */
const anchors=['#home','#work','#reels','#about','#contact'];
addEventListener('keydown',e=>{
  if('12345'.includes(e.key)){ location.hash=anchors[+e.key-1]; }
  if(e.key==='p'||e.key==='P') window.print();
  if(e.key===']'){ cyclePalette(1); }
  if(e.key==='['){ cyclePalette(-1); }
});

/* ===== contact ===== */
function sendMail(e){
  e.preventDefault();
  const name=$('#name').value.trim(), email=$('#email').value.trim(), msg=$('#msg').value.trim();
  const subject=encodeURIComponent(`Portfolio inquiry from ${name}`);
  const body=encodeURIComponent(`${msg}\n\n— ${name}\n${email}`);
  location.href=`mailto:${EMAIL}?subject=${subject}&body=${body}`;
}
$('#copyEmail').onclick=()=>navigator.clipboard.writeText(EMAIL);
</script>
</body>
</html>
